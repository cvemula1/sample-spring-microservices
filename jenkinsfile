#!/usr/bin/env groovy
def branch = 'master'
def repo = "https://github.com/cvemula1/K8s-Docker-Jenkins-CICD.git"
{
    node('default') {
        stage ("build") {
                git repo
                sh "mvn clean install"
				sh " cd account-service"
				sh "docker build -t account-service ."
				sh "docker tag account-service:latest rahulnallari/microservice-springboot:account-service"
				#sh "docker tag helloworld:latest <AwsAccountid>.dkr.ecr.us-west-2.amazonaws.com/helloworld:latest"
				sh "docker push rahulnallari/microservice-springboot:account-service"
				sh " cd ../customer-service
				sh " docker build -t customer-service .
				sh "docker tag customer-service:latest rahulnallari/microservice-springboot:customer-service"
				sh " cd ../discovery-service
				sh "docker tag discovery-service:latest rahulnallari/microservice-springboot:discovery-service"
            }
        }
}
