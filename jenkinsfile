#!/usr/bin/env groovy
def branch = 'master'
def repo = "https://github.com/cvemula1/K8s-Docker-Jenkins-CICD.git"
{
    node('default') {
        stage ("build") {
                git repo
                sh "mvn clean install"
				sh "cd account-service".execute()
				sh "docker build -t account-service .".execute()
				sh "docker tag account-service:latest rahulnallari/microservice-springboot:account-service".execute()
				sh "docker push rahulnallari/microservice-springboot:account-service".execute()
				sh "cd ../customer-service".execute()
				sh "docker build -t customer-service .".execute()
				sh "docker tag customer-service:latest rahulnallari/microservice-springboot:customer-service".execute()
				sh "cd ../discovery-service".execute()
				sh "docker tag discovery-service:latest rahulnallari/microservice-springboot:discovery-service".execute()
            }
        }
}
